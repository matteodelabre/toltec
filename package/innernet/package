#!/usr/bin/env bash
# Copyright (c) 2021 The Toltec Contributors
# SPDX-License-Identifier: MIT

pkgnames=(innernet-client)
pkgdesc="A private network system that uses WireGuard under the hood."
url="https://github.com/tonarino/innernet"
pkgver=1.2.0-beta-1-1
timestamp=2021-04-21T18:26Z
section="utils"
maintainer="plan5 <30434574+plan5@users.noreply.github.com>"
license=MIT
installdepends=(wireguard)
makedepends=(build:librust-clang-sys-dev build:libclang-dev build:libc6 build:libc6-dev build:clang build:gcc-multilib build:g++-multilib)

image=rust:v1.4
source=(https://github.com/tonarino/innernet/archive/refs/tags/v1.2.0-beta.1.zip)
sha256sums=(7a360c2049ab99001ae457c1afa08048bf6f170de8f624625aa3e03d4552c6c0)

prepare() {
    #tbd: change config dir to /opt/etc/innernet?
    sed -i "s/\/etc\/innernet/\/opt\/etc\/innernet/g"  "$srcdir/shared/src/lib.rs"

    #tbd: change config dir to /opt/etc/innernet?
    sed -i "s/\/var\/lib\/innernet/\/opt\/etc\/innernet/g"  "$srcdir/shared/src/lib.rs"

    #tbd: change wireguard config dir to /opt/etc/wireguard?
    #sed -i "s/\/etc\/wireguard/\/opt\/etc\/wireguard/g"  "$srcdir/shared/src/lib.rs"
}

build() {
    cargo build --release --bin innernet
}

package() {
    install -D -m 755 -t "$pkgdir"/opt/bin "$srcdir"/target/armv7-unknown-linux-gnueabihf/release/innernet
}
