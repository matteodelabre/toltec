#!/usr/bin/env bash
# Copyright (c) 2020 The Toltec Contributors
# SPDX-License-Identifier: MIT

pkgnames=(rm2fb)
timestamp=2020-10-10T01:41+00:00
maintainer="raisjn <of.raisjn@gmail.com>"
license=MIT
pkgdesc="Remarkable2 Framebuffer"
url="https://github.com/ddvk/remarkable2-framebuffer"
pkgver=1.0.0-1
section=utils
version=1.0.0
image=qt:v1.1
source=(
    https://github.com/ddvk/remarkable2-framebuffer/archive/5a518c8d3fe3fe500b33c620330d62094564173f.zip
    rm2fb.service
    rm2fb-server
    rm2fb-client
)
sha256sums=(
    bbf090f83c8090f20f0319283279ecbde783fcb3ca9b8610b7dde309001592cd
    SKIP
    SKIP
    SKIP
)

build() {
    qmake
    make
    arm-linux-gnueabihf-strip src/client/librm2f_client.so.1.0.0
}

package() {
    mkdir -p "$pkgdir"/opt/lib "$pkgdir"/opt/etc "$pkgdir"/opt/bin
    install -D -m 644 "$srcdir"/rm2fb.service "$pkgdir"/lib/systemd/system/rm2fb.service
    install -D -m 755 "$srcdir"/src/client/librm2fb_client.so.${version} "$pkgdir"/opt/lib/
    install -D -m 755 "$srcdir"/src/server/librm2fb_server.so.${version} "$pkgdir"/opt/lib/
    # install -D -m 755 "$srcdir"/src/xofb/librm2fb_xofb.so.${version} "$pkgdir"/opt/lib/
    install -D -m 644 "$srcdir"/rm2fb.service "$pkgdir"/lib/systemd/system/rm2fb.service
    install -D -m 755 "$srcdir"/rm2fb-server "$pkgdir"/opt/bin/
    install -D -m 755 "$srcdir"/rm2fb-client "$pkgdir"/opt/bin/
}
